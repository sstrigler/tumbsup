link(rel='stylesheet', href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css')
script(src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')
script(src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js')
script(src='/socket.io/socket.io.js')
script
  var socket = io.connect('#{host}');
  $(document).ready(function() {
      $('#progressbar').progressbar({value: 0});
  });
  function getLikes(button) {
    $(button).hide();
    var num_photos = photos_received = 0;
    $('#progressbar').progressbar("option", "value", 0);
    socket.emit('get_likes');
    socket.on('progress', function(progress) {
      console.log(progress);
      $('#progressbar').progressbar("option", "value", progress);
    });
    socket.on('status', function(status) {
      console.log(status);
      $('#status').html(status);
    });
    socket.on('done', function() {
      socket.removeAllListeners('progress');
      socket.removeAllListeners('status');
      //$(button).show();
    }); 

    return false;
  }
  function logout() {
    document.location.href = '/logout';
  }
h2 Welcome, #{everyauth.tumblr.user.name}!
p 
  | You've got #{info.user.likes} likes.
  if info.user.likes > limit
    |  There's a limit of #{limit} likes, so you won't be able to download them all. We're sorry!
  div#progressbar
  div#status
  div
    button(onclick='return getLikes(this)') Get'em all!
hr
h3
  button(onclick='return logout();') Logout
